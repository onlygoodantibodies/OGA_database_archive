<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    {% load static %}
    <!-- Add Google Fonts Link -->
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600&family=Lora:wght@700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'core/styles.css' %}">
    <title>OGA - Only Good Antibodies Community</title>
    <link rel="icon" type="image/x-icon" href="{% static 'core/up-logo.ico' %}">
    <script>
        let geneCache = []; // Cache for gene names and elements

        // Debounce function to optimize input events
        function debounce(func, delay) {
            let timeout;
            return function (...args) {
                clearTimeout(timeout);
                timeout = setTimeout(() => func.apply(this, args), delay);
            };
        }
        
        // Filter and display suggestions under the search bar
        function showSuggestions() {
            const query = document.querySelector('.search-bar').value.toLowerCase().trim();
            const suggestionBox = document.querySelector('.suggestion-box');
            suggestionBox.innerHTML = ''; // Clear previous suggestions
        
            let hasSuggestions = false;
        
            if (query) {
                geneCache.forEach(({ geneName, geneId }) => {  // Include geneId for URL generation
                    if (geneName.includes(query)) {
                        const suggestion = document.createElement('div');
                        suggestion.classList.add('suggestion');
                        suggestion.innerText = geneName;
                        suggestion.addEventListener('click', () => {
                            window.location.href = `/${geneId}/`; // Redirect to the antibody page
                        });
                        suggestionBox.appendChild(suggestion);
                        hasSuggestions = true;
                    }
                });
            }
        
            suggestionBox.style.display = hasSuggestions ? 'block' : 'none';
        }
        
        // Handle search on Enter key
        function handleSearch(event) {
            if (event.key === 'Enter') {
                event.preventDefault();
                const query = document.querySelector('.search-bar').value.toLowerCase().trim();
                const noResultsMessage = document.getElementById('no-results-message');
                let hasResults = false;
        
                geneCache.forEach(({ geneName, element }) => {
                    if (geneName.includes(query)) {
                        element.style.display = '';  // Show matching boxes
                        hasResults = true;
                    } else {
                        element.style.display = 'none';  // Hide non-matching boxes
                    }
                });
        
                noResultsMessage.style.display = query && !hasResults ? 'block' : 'none';
                document.querySelector('.suggestion-box').style.display = 'none'; // Hide suggestions after search
            }
        }
        
        // Cache the gene names and DOM elements on page load
        document.addEventListener('DOMContentLoaded', function () {
            const geneBoxes = document.querySelectorAll('.gene-box');
            const searchBar = document.querySelector('.search-bar');
            const suggestionBox = document.createElement('div');
            suggestionBox.classList.add('suggestion-box');
            document.querySelector('.search-container').appendChild(suggestionBox); // Add the suggestion box below the search bar
        
            // Cache gene names and elements
            geneBoxes.forEach((box) => {
                const geneName = box.querySelector('h3').innerText.toLowerCase();
                const geneId = box.getAttribute('data-gene-id'); // Get the gene's unique ID
                geneCache.push({ geneName, geneId, element: box });
            });
        
            searchBar.addEventListener('input', debounce(showSuggestions, 300));
            searchBar.addEventListener('keypress', handleSearch);
        });
        
    </script>
</head>
<body class="home-page">
    {% include 'core/cookie_banner.html' %}
<script src="{% static 'core/script.js' %}"></script>

    <!-- Header Section -->
    <header class="header">
        <div class="logo-home">
            <a href="{% url 'home' %}"> <!-- Link to the home page -->
                <img src="{% static 'core/logo778.png' %}" alt="Logo" class="logo-img">
            </a>
        </div>  
        
    <!-- Hamburger Icon -->
    <div class="hamburger">â˜°</div>

    <!-- Navigation Menu -->
        <nav>
            <ul class="menu">
                <li><a href="{% url 'home' %}">Home</a></li>
                <li><a href="{% url 'about' %}">About Us</a></li>
                <li><a href="{% url 'publications' %}">Publications</a></li>
                <li><a href="{% url 'projects' %}">Projects</a></li>
                <li><a href="{% url 'news' %}">News</a></li>
                <li><a href="{% url 'partners' %}">Partners</a></li>
                <li><a href="{% url 'contact' %}" class="active">Contact</a></li>
            </ul>
        </nav>
    </header>


    <!-- Search Bar -->
    <div class="search-bar-wrapper" style="position: relative;">
        <form method="get" class="search-container">
            <input 
                class="search-bar" 
                type="text" 
                placeholder="Search" 
                name="search" 
                value="{{ search_query|default:'' }}"
            >
        </form>
        <div class="suggestion-box"></div> <!-- Suggestion box outside the form -->
    </div>

    <div class="beta-test-notice" style="padding: 10px 0; font-size: 0.9rem; margin-top: 3px; margin-bottom: 3px; line-height: 1;">
        This website is a beta test
    </div>
    

    <!-- Educational Material Section -->
    <section class="educational-section">
     <div class="edu-box">
        <h3>Choosing the Right Antibody for Your Application</h3>
        <p>Learn how to choose the right antibody for techniques like Western blot, IP, IF, and flow cytometry</p>
        <a href="{% url 'resources' %}" class="learn-more-button">Learn More</a>
     </div>
     <div class="edu-box">
        <h3>Leveraging YCharOS Open Antibody Data</h3>
        <p>Gain insights from YCharOS's open antibody data to improve antibody selection</p>
        <a href="https://f1000research.com/articles/12-1344" class="learn-more-button" target="_blank" rel="noopener noreferrer">Learn More</a>
     </div>
    
    </section>

    <!-- Gene List Section -->
<section class="gene-list">
    <h2>Genes Available</h2>
    <div class="gene-list-container">
        {% for gene in genes %}
        <div class="gene-box" data-name="{{ gene.name }}" data-gene-id="{{ gene.id }}">
            <h3>{{ gene.name }}</h3>
            <p>Related Antibodies: {{ gene.antibodies.count }}</p>
            <a href="{% url 'antibody_table' gene.id %}" class="details-button">View Details</a>
        </div>
        {% endfor %}
    </div>
</section>


    <!-- No Results Message -->
    <div id="no-results-message" class="no-results">
      <p>Didn't find what you're looking for?</p>
      <a href="{% url 'contact' %}" class="nominate-target-button">Nominate a Target</a>
    </div>

<!-- Footer -->
<footer class="footer">
    <div class="footer-container">
        <!-- Quick Links Column -->
        <div class="footer-column">
            <h4>Quick Links</h4>
            <a href="{% url 'home' %}"class="active">Home</a>
            <a href="{% url 'about' %}">About Us</a>
            <a href="{% url 'publications' %}">Publications</a>
            <a href="{% url 'projects' %}">Projects</a>
            <a href="{% url 'news' %}">News</a>
            <a href="{% url 'contact' %}">Contact</a>
        </div>

        <!-- Contact Information Column -->
        <div class="footer-column">
            <h4>Contact Us</h4>
            <p>Email: onlygoodantibodies@gmail.com</p>
            <p>LinkedIn: <a href="https://www.linkedin.com/company/onlygoodantibodies-community-and-forum/posts/?feedView=all" target="_blank">Follow us on LinkedIn</a></p>
            <p>X: <a href="https://x.com/OGA_Community" target="_blank">Follow us on X</a></p>
        </div>

        <!-- Social Media Column -->
        <div class="footer-column">
            <h4>Follow Us</h4>
            <a href="https://www.linkedin.com/company/onlygoodantibodies-community-and-forum/posts/?feedView=all" target="_blank">
                <img src="{% static 'core/linkedin-logo.webp' %}" alt="LinkedIn" class="social-icon">
            </a>
            <a href="https://x.com/OGA_Community" target="_blank">
                <img src="{% static 'core/x.png' %}" alt="LinkedIn" class="social-icon">
            </a>
            <!-- Add other social media icons here -->
        </div>
    </div>

    <!-- Bottom Footer with Copyright and Back to Top -->
    <div class="footer-bottom">
        <p>&copy; 2024 Better Antibodies Community. All Rights Reserved.</p>
        <button onclick="window.scrollTo({top: 0, behavior: 'smooth'});" class="back-to-top">Back to Top</button>
    </div>
</footer>

<script src="{% static 'core/script.js' %}"></script>

</body>
</html>
